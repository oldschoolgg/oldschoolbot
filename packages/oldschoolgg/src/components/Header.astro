---
import Button from './Button.astro';

const links = [
	{ label: 'Commands', href: '/commands' },
	{ label: 'Widgets', href: '/commands' }
	// {
	// 	label: 'Tools',
	// 	children: [{ label: 'Troll Video Generator', href: '/blog' }]
	// }
];
---

<header class="w-full  backdrop-blur-md py-4">
  <div class="max-w-4xl mx-auto px-4 sm:px-6 py-4">
    <nav class="flex items-center justify-between">
      <a href="/">
        <h1 class="text-5xl font-semibold">Oldschool.gg</h1>
      </a>

      <button
        id="mobile-menu-button"
        class="lg:hidden p-2 hover:opacity-70 transition-opacity"
        aria-label="Toggle menu"
      >
        <svg class="w-6 h-6" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/>
        </svg>
      </button>

      <div class="hidden lg:flex items-center gap-8 font-semibold">
        {links.map((link) => (
          link.children ? (
            <div class="relative dropdown cursor-pointer">
              <button class="flex items-center gap-1 hover:opacity-70 transition-opacity dropdown-trigger">
                {link.label}
                <svg class="w-4 h-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                </svg>
              </button>
              <div class="absolute top-full left-0 mt-2 w-58 rounded-lg border-main bg-primary shadow-lg hidden dropdown-menu">
                {link.children.map((child) => (
                  <a href={child.href} class="block px-4 py-3 hover:opacity-70 transition-opacity">
                    {child.label}
                  </a>
                ))}
              </div>
            </div>
          ) : (
            <a href={link.href} class="hover:opacity-70 transition-opacity">
              {link.label}
            </a>
          )
        ))}
      </div>

      <div class="hidden lg:flex items-center gap-4">
		<Button size="sm" variant="discord" href="/login">Login With Discord</Button>
      </div>
    </nav>

    <!-- Mobile Menu -->
    <div id="mobile-menu" class="hidden lg:hidden mt-4 pb-4 border-t pt-4">
      <div class="flex flex-col gap-4">
        {links.map((link) => (
          link.children ? (
            <!-- Mobile Dropdown -->
            <div class="mobile-dropdown">
              <button class="flex items-center justify-between w-full hover:opacity-70 transition-opacity mobile-dropdown-trigger">
                <span>{link.label}</span>
                <svg class="w-4 h-4 mobile-dropdown-icon transition-transform" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"/>
                </svg>
              </button>
              <div class="hidden mobile-dropdown-menu pl-4 mt-2 flex-col gap-2">
                {link.children.map((child) => (
                  <a href={child.href} class="py-2 hover:opacity-70 transition-opacity">
                    {child.label}
                  </a>
                ))}
              </div>
            </div>
          ) : (
            <a href={link.href} class="hover:opacity-70 transition-opacity">
              {link.label}
            </a>
          )
        ))}

        <Button variant="kick" href="/login">Login With Kick</Button>
      </div>
    </div>
  </div>
</header>

<script>
  document.addEventListener('DOMContentLoaded', () => {
    // Mobile menu toggle
    const mobileMenuButton = document.getElementById('mobile-menu-button');
    const mobileMenu = document.getElementById('mobile-menu');

    if (mobileMenuButton && mobileMenu) {
      mobileMenuButton.addEventListener('click', () => {
        mobileMenu.classList.toggle('hidden');
      });
    }

    // Desktop dropdown functionality
    const dropdowns = document.querySelectorAll('.dropdown');

    dropdowns.forEach(dropdown => {
      const trigger = dropdown.querySelector('.dropdown-trigger');
      const menu = dropdown.querySelector('.dropdown-menu');

      if (trigger && menu) {
        trigger.addEventListener('click', (e) => {
          e.stopPropagation();
          // Close other dropdowns
          document.querySelectorAll('.dropdown-menu').forEach(m => {
            if (m !== menu) m.classList.add('hidden');
          });
          // Toggle current dropdown
          menu.classList.toggle('hidden');
        });
      }
    });

    // Mobile dropdown functionality
    const mobileDropdowns = document.querySelectorAll('.mobile-dropdown');

    mobileDropdowns.forEach(dropdown => {
      const trigger = dropdown.querySelector('.mobile-dropdown-trigger');
      const menu = dropdown.querySelector('.mobile-dropdown-menu');
      const icon = dropdown.querySelector('.mobile-dropdown-icon');

      if (trigger && menu) {
        trigger.addEventListener('click', () => {
          menu.classList.toggle('hidden');
          menu.classList.toggle('flex');
          icon?.classList.toggle('rotate-180');
        });
      }
    });

    // Close desktop dropdowns when clicking outside
    document.addEventListener('click', () => {
      document.querySelectorAll('.dropdown-menu').forEach(menu => {
        menu.classList.add('hidden');
      });
    });
  });
</script>

<style>
  /* Desktop dropdown animation */
  .dropdown-menu {
    animation: fadeIn 0.2s ease-in-out;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(-10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  /* Mobile dropdown icon rotation */
  .mobile-dropdown-icon {
    transition: transform 0.3s ease;
  }

  .rotate-180 {
    transform: rotate(180deg);
  }
</style>
